%% LyX 2.3.4.2 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[english,xcolor=svgnames, handout]{beamer}
\usepackage{mathpazo}
\usepackage[T1]{fontenc}
\usepackage[latin9]{inputenc}
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{graphicx}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
%% Because html converters don't know tabularnewline
\providecommand{\tabularnewline}{\\}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Textclass specific LaTeX commands.
% this default might be overridden by plain title style
\newcommand\makebeamertitle{\frame{\maketitle}}%
% (ERT) argument for the TOC
\AtBeginDocument{%
  \let\origtableofcontents=\tableofcontents
  \def\tableofcontents{\@ifnextchar[{\origtableofcontents}{\gobbletableofcontents}}
  \def\gobbletableofcontents#1{\origtableofcontents}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
\setcounter{MaxMatrixCols}{10}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{mathpazo}
\usepackage{hyperref}
%\usepackage{multimedia}
\usepackage{movie15}
\usepackage{xcolor}
\usepackage{colortbl}
\definecolor{RawSienna}{cmyk}{0,0.87,0.82,0.31}
\definecolor{gray97}{cmyk}{0,0,0,0.03}
\definecolor{robinsegg}{cmyk}{0.18,0.04,0,0.07}
\definecolor{cola}{cmyk}{0,0.315,0.35,0.155}

\newenvironment{stepenumerate}{\begin{enumerate}[<+->]}{\end{enumerate}}
\newenvironment{stepitemize}{\begin{itemize}[<+->]}{\end{itemize} }
\newenvironment{stepenumeratewithalert}{\begin{enumerate}[<+-| alert@+>]}{\end{enumerate}}
\newenvironment{stepitemizewithalert}{\begin{itemize}[<+-| alert@+>]}{\end{itemize} }
\usecolortheme[named=RawSienna]{structure}
%\usecolortheme[RGB={205,0,0}]{structure}
\setbeamertemplate{navigation symbols}{}
\useoutertheme{infolines}
\usetheme{default}
\setbeamertemplate{blocks}[shadow=true]
%\setbeamerfont{structure}{shape=\itshape}
\usefonttheme{structuresmallcapsserif}
\setbeamertemplate{background canvas}{
 % \ifnum \thepage>0 \relax % we are on the first page
%\includegraphics[width=\paperwidth,height=\paperheight]{/home/mv/Dropbox/Foton/IconsWallpaper/greyribbonLighter.jpg}
 % \else
 	% No background for page 2 and onwards
 % \fi
}

\makeatother

\usepackage{babel}
\begin{document}
<<setup, include=FALSE>>=
library(knitr)
library(ggplot2)
library(tikzDevice)
source("MVutils.R")
opts_chunk$set(fig.path='figure/beamer-',fig.align='center',fig.show='hold',size='footnotesize')
@

<<echo=FALSE>>=
read_chunk('Lecture4SlideCode.R')
@
\title[TDAB01]{Sannolikhetslära och Statistik\\
Föreläsning 12}
\author[Mattias Villani]{Mattias Villani}
\institute[\textbf{STIMA, LiU}]{\textbf{Avdelningen för Statistik och Maskininlärning}\\
\textbf{Institutionen för datavetenskap}\\
\textbf{Linköpings universitet }}
\date{\includegraphics[scale=0.15]{LiU_secondary_1_black}\,}
\makebeamertitle
\begin{frame}{Översikt}

\begin{itemize}
\item \textbf{\textcolor{blue}{Prediktion}}\bigskip{}
\item \textbf{\textcolor{blue}{Beslut}}
\end{itemize}
\end{frame}

\begin{frame}{Prediktion}

\begin{itemize}
\item \textbf{Prediktion}: inferens för okända men potentiellt observerbara
kvantiteter.

\begin{itemize}
\item antalet buggar i en kod.
\item sjukdom.
\item mängden brytbara mineraler.\bigskip{}
\end{itemize}
\item \textbf{Prognos}: prediktion av framtida utfall.

\begin{itemize}
\item lägenhetspriserna i Linköping Jan 2020. 
\item framtida försäljning. 
\item slutpris i en eBay auktion.
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Prediktion för att utvärdera modeller}

\begin{itemize}
\item Prediktion är också ett utmärkt sätt att \textbf{utvärdera} och \textbf{jämföra}
\textbf{modeller}. En korrekt modell predikterar bra.\bigskip{}
\item \textbf{\textcolor{blue}{Träningsdata}} - \textbf{\textcolor{blue}{testdata}}.\bigskip{}
\item \textbf{\textcolor{blue}{Accuracy}}: antal korrekt klassificeringar
/ totala antalet test data observationer.\bigskip{}
\item Handwritten digits data (3000 obs för träning, 10000 för test):

\begin{itemize}
\item Multinomial regression med elastic net: accuracy = 88.49\%
\item Support vector machine: accuracy: 89.42\%
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Prediktion i regression}

\begin{itemize}
\item Linjär regression
\[
y=\beta_{0}+\beta_{1}x+\varepsilon,\;\varepsilon\sim N(0,\sigma^{2})
\]
\item Vad blir \textbf{prediktionen} av $Y$ för ett nytt x-värde, $x_{\star}$?
\[
\mu_{\star}=E\left(Y\vert X=x_{\star}\right)=\beta_{0}+\beta_{1}x_{\star}
\]
som vi skattar med 
\[
\hat{y}_{\star}=\hat{\beta}_{0}+\hat{\beta_{1}}x_{\star}
\]
\item Se Baron s. 377-378 för härledning av samplingfördelning, standardfel
och konfidensintervall för $\hat{y}_{\star}$.
\item Ett konfidensintervall för $\hat{y}_{\star}$ är osäkerheten om \textbf{populationens
väntevärde} vid $x=x_{\star}$. Dvs osäkerheten om regressionslinjen.
\item Men hur ser osäkerheten för ett faktiskt $y$-värde ut om $x=x_{\star}$? 
\item \textbf{\textcolor{blue}{Prognosintervall}} för $Y$ när $x=x_{\star}$
\[
\hat{\beta}_{0}+\hat{\beta_{1}}x_{\star}\pm t_{\alpha/2}\cdot s\cdot\sqrt{1+\frac{1}{n}+\frac{(x_{\star}-\bar{x})^{2}}{S_{xx}}}
\]
\end{itemize}
\end{frame}

\begin{frame}{Bayesiansk prediktion}

\begin{itemize}
\item \textbf{\textcolor{blue}{Prediktiv fördelning}} för ny observation
$\tilde{X}$: 
\[
p(\tilde{x}\vert x_{1},...,x_{n})=\int f(\tilde{x}\vert x_{1},...,x_{n},\theta)\pi(\theta\vert x_{1},...,x_{n})d\theta
\]
\item Exempel: $x_{1},...,x_{n}\vert\theta\sim N(\theta,\sigma^{2})$ och
$\sigma^{2}$ känd.
\item Prediktiv fördelning
\[
\tilde{x}|x_{1},...,x_{n}\sim N\left(\mu_{x},\tau_{x}^{2}+\sigma^{2}\right)
\]
\item Vår bästa prognos: $\mu_{x}=\mathbb{E}(\theta\vert x_{1},...,x_{n})$. 
\item \textbf{\textcolor{blue}{Prediktionsvarians}} = Varians pga osäkerhet
om $\theta$ ($\tau_{x}^{2}$) + Varians pga osäkerhet i populationen
kring $\theta$($\sigma^{2}$).
\item Prediktiv fördelning genom \textbf{\textcolor{blue}{simulering}}:
\begin{enumerate}
\item Simulera parameter $\theta^{(1)}\sim\pi(\theta\vert x_{1},...,x_{n})$
\item Simulera observeration $\tilde{x}\sim f(\tilde{x}|\theta^{(1)})$
\item Upprepa Steg 1 och 2 många ggr
\end{enumerate}
\end{itemize}
\end{frame}

\begin{frame}{Bayesiansk prediktion - AR-process}

\begin{itemize}
\item \textbf{\textcolor{blue}{Autoregressiv process }}av första ordningen
\[
y_{t}=\mu+\phi(y_{t-1}-\mu)+\varepsilon_{t},\;\;\varepsilon_{t}\overset{iid}{\sim}N(0,\sigma^{2})
\]
\item Posterior: $\pi(\phi,\mu,\sigma\vert y_{1},...,y_{T})$.
\item Vi är intresserade av \textbf{$h$-stegs prognosfördelningen}: $p(y_{T+1},y_{T+2},...,y_{T+h}\vert y_{1},...,y_{T})$.
\item \textbf{Simulering} från $p(y_{T+1},y_{T+2},...,y_{T+h}\vert y_{1},...,y_{T})$:

\begin{enumerate}
\item Simulera $\theta^{(1)}=(\phi^{(1)},\mu^{(1)},\sigma^{(1)})$ från
posteriorn $\pi(\phi,\mu,\sigma|y_{1},...,y_{T})$
\item Betingat på $\theta=\theta^{(1)}$ simulera en \textbf{prognosbana} 
\end{enumerate}
\begin{itemize}
\item $\tilde{y}_{T+1}^{(1)}\sim$$f(y_{T+1}|y_{T},{\color{red}\theta^{(1)}})$
\item $\tilde{y}_{T+2}^{(1)}\sim f(y_{T+2}|{\color{blue}\tilde{y}}_{{\color{blue}T+1}}^{{\color{blue}(1)}},{\color{red}\theta^{(1)}})$
\item ...
\item $\tilde{y}_{T+h}^{(1)}\sim f(y_{T+h}|{\color{blue}\tilde{y}}_{{\color{blue}T+h-1}}^{{\color{blue}(1)}},{\color{red}\theta^{(1)}})$
\end{itemize}
\item Upprepa steg 1 och 2 ett stort antal gånger.
\end{itemize}

\pause{}

\end{frame}

\begin{frame}{AR(1)-process}

\begin{center}
\includegraphics[scale=0.55]{AR1Process}
\par\end{center}

\pause{}

\end{frame}

\begin{frame}{Bayesian $h$-step ahead predictive distribution}

\begin{center}
\includegraphics{ForecastDistRepoRate}
\par\end{center}

\pause{}

\end{frame}

\begin{frame}{Beslutsteori}

\begin{itemize}
\item Låt $\theta\in\Theta$ vara en \textbf{\textcolor{blue}{okänd kvantitet}},
\textbf{\textcolor{blue}{tillstånd}}. \\
Exempel: Sjukdom, Global temperaturökning, antalet buggar.\bigskip{}
\item Låt $a\in\mathcal{A}$ vara ett \textbf{\textcolor{blue}{beslut}}
(eng. action). \\
Ex: operation, energisskatt, releasedatum.\bigskip{}
\item Välja beslut $a$ när tillståndet visar sig vara $\theta$ ger dig
\textbf{\textcolor{blue}{nyttan }}(eng. utility)
\[
U(a,\theta)
\]
\bigskip{}
\item Alternativt: \textbf{\textcolor{blue}{förlust}} (eng. loss): 
\[
L(a,\theta)=-U(a,\theta)
\]
.
\end{itemize}
\end{frame}

\begin{frame}{Diskreta tillstånd, diskreta beslut}

\begin{itemize}
\item Förlusttabell för problem med två möjliga $\theta$-utfall och två
möjliga beslut:
\end{itemize}
\begin{center}
\begin{tabular}{c|cc}
 & $\theta_{1}$ & $\theta_{2}$\tabularnewline
\hline 
$a_{1}$ & \textrm{\scriptsize{}\cellcolor{robinsegg}}$L(a_{1},\theta_{1}$) & \textrm{\scriptsize{}\cellcolor{robinsegg}}$L(a_{1},\theta_{2}$)\tabularnewline
$a_{2}$ & \textrm{\scriptsize{}\cellcolor{robinsegg}}$L(a_{2},\theta_{1}$) & \textrm{\scriptsize{}\cellcolor{robinsegg}}$L(a_{2},\theta_{2}$)\tabularnewline
\end{tabular}
\par\end{center}
\begin{itemize}
\item Exempel:
\end{itemize}
\begin{center}
\begin{tabular}{c|cc}
 & Regnigt & Soligt\tabularnewline
\hline 
Paraply & \textrm{\scriptsize{}\cellcolor{robinsegg}}20 & \textrm{\scriptsize{}\cellcolor{robinsegg}}10\tabularnewline
Inget paraply & \textrm{\scriptsize{}\cellcolor{robinsegg}}50 & \textrm{\scriptsize{}\cellcolor{robinsegg}}0\tabularnewline
\end{tabular}
\par\end{center}

\end{frame}

\begin{frame}{Beslut}

\begin{itemize}
\item \textbf{Tillståndrummet} $\Theta$ kan vara diskret eller kontinuerligt.\medskip{}
\item \textbf{Beslutsrummet} $\mathcal{A}$ kan vara diskret eller kontinuerligt.\medskip{}
\item Kontinuerligt $\Theta$, diskret $\mathcal{A}$:

\begin{itemize}
\item Brobygge: $\theta=$grad av miljöpåverkan och $\mathcal{A}=\left\{ \text{bygga},\text{ej bygga}\right\} $.\medskip{}
\end{itemize}
\item Diskret $\Theta$, kontinuerligt $\mathcal{A}$:

\begin{itemize}
\item $\theta=$antalet buggar. $\theta\in\{0,1,2,...\}$ och $\mathcal{A}={\text{releasetid}}$.
\item brottsdom. $\theta\in\{\text{oskyldig},\text{skyldig}\}$. $\mathcal{A}=\{\text{tid i fängelse}\}$.\medskip{}
\end{itemize}
\item Kontinuerligt $\Theta$, Kontinuerligt $\mathcal{A}$:

\begin{itemize}
\item $\theta=\text{efterfrågan på produkt}$, $\mathcal{A}=\{\text{hur många enheter i lager?}\}$ 
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Kontinuerliga tillstånd, kontinuerliga beslut}

\begin{itemize}
\item Exempel på \textbf{\textcolor{blue}{förlustfunktioner}} när både $a$
och $\theta$ är kontinuerliga: 

\begin{itemize}
\item \textbf{\textcolor{blue}{Linjär}}: $L(a,\theta)=\left|a-\theta\right|$
\item \textbf{\textcolor{blue}{Kvadratisk}}: $L(a,\theta)=(a-\theta)^{2}$
\item \textbf{\textcolor{blue}{Lin-Lin}}: 
\[
L(a,\theta)=\begin{cases}
c_{1}\cdot\left|a-\theta\right| & \textrm{if \ensuremath{a\leq\theta}}\\
c_{2}\cdot\left|a-\theta\right| & \textrm{if \ensuremath{a>\theta}}
\end{cases}
\]
\end{itemize}
\item Exempel: 

\begin{itemize}
\item $\theta$ antalet efterfrågade produkter
\item $a$ antal produkter i lager
\item Nytta
\[
U(a,\theta)=\begin{cases}
p\cdot\theta-c_{1}(a-\theta) & \textrm{om \ensuremath{a>\theta}\text{ [för stort lager]}}\\
p\cdot a-c_{2}(\theta-a)^{2} & \textrm{om \ensuremath{a\leq\theta}\text{ [för litet lager]}}
\end{cases}
\]
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Optimala beslut}

\begin{itemize}
\item Exempel på vanlig beslutsregel:\emph{ }\textbf{Minimax}. Välj det
beslut som minimerar den maximala förlusten.
\item Bayes: Välj det beslut som \textbf{\textcolor{blue}{maximerar}} \textbf{\textcolor{blue}{förväntad
nytta}}\textbf{ }a posteriori:
\[
a_{bayes}=\mathrm{argmax}{}_{a\in\mathcal{A}}\text{ }\mathbb{E}[U(a,\theta)],
\]
där \textrm{$\mathbb{E}$ är väntevärdet med avseende på aposteriorn
$p(\theta\vert Data)$.}
\item I praktiken: simulera $\theta^{(1)},$$\theta^{(2)},...,\mbox{\ensuremath{\theta}}^{(N)}$
från $p(\theta\text{|}Data)$ och approximera
\[
\text{ }\mathbb{E}[U(a,\theta)]\approx N^{-1}\sum_{i=1}^{N}U(a,\theta^{(i)})
\]
\item \textbf{\textcolor{blue}{Separationsprincipen}}: 
\end{itemize}
\begin{enumerate}
\item Ta först fram $p(\theta\vert Data)$ ...
\item därefter $U(a,\theta)$ och slutligen ...
\item välj det $a\in\mathcal{A}$ som maximerar $\mathbb{E}[U(a,\theta)]$.
\end{enumerate}
\end{frame}

\begin{frame}{Väntevärde, median eller typvärde?}

\begin{itemize}
\item Hur kan vi bäst sammanfatta en aposteriorifördelning $p(\theta\vert Data)$
med ett enda tal?\medskip{}
\item Att välja en punktskattning är ett beslutsproblem.
\end{itemize}
\medskip{}

\begin{itemize}
\item Valet beror på din förlustfunktion:

\begin{itemize}
\item \textbf{Linjär förlust }$\rightarrow$ Posterior median är optimal
\item \textbf{Quadratic loss }$\rightarrow$ Posteriorväntevärdet $\mathbb{E}(\theta\vert Data)$
är optimal
\item \textbf{Lin-Lin loss }$\rightarrow$ $c_{1}/(c_{1}+c_{2})$ kvantilen
i posteriorn är optimal
\item \textbf{Noll-ett förlust} $\rightarrow$ Posterior typvärdet är optimalt
\end{itemize}
\end{itemize}
\medskip{}

\end{frame}

\begin{frame}{Förlustfunktioner}

\begin{center}
\includegraphics[scale=0.5]{Lossfunctions}
\par\end{center}

\medskip{}

\end{frame}


\end{document}
